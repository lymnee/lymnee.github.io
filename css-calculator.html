<!doctype html>
<html data-eenmyl data-ym-display="block" data-ym-font-size="2.25vw@media screen and (max-width: 1023px) || large@media screen and (min-width: 1024px)" lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="The calculator uses the Css calc() function to solve the four basic arithmetic operations.">
<meta name="keywords" content="CSS calc(), Css, JavaScript">
<meta name="author" content="Vincent Top-Roulet">
<link rel="icon" href="%20" data-icon="䷃" type="image/png" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<title>Fun calculator with Css calc()</title>
</head>
<body data-ym-color="var(--primary-text-color)"  data-ym-display="grid" data-ym-font-family="var(--font-family)" data-ym-font-weight="var(--font-weight-regular)" data-ym-grid-template-columns="1fr || 1fr auto@media screen and (min-width: 1024px)" data-ym-gap="calc(var(--ss) * 1rem)" data-ym-grid-template-rows="repeat(4, auto) || auto 1fr@media screen and (min-width: 1024px)" data-ym-justify-items="center@media screen and (max-width: 1023px)" data-ym-line-height="var(--line-height)"  data-ym-margin="auto" data-ym-max-width="1024px@media screen and (min-width: 1024px)" data-ym-width="calc(100vw - calc(var(--xs) * 1rem))@media screen and (max-width: 1023px)">
        <h1 data-ym-color="var(--primary-text-color)"
        data-ym-font-size="calc(var(--xs) * 1rem)" data-ym-grid-column="1@media screen and (min-width: 1024px)" data-ym-grid-row="1@media screen and (min-width: 1024px)" data-ym-hyphens="auto">
        <span data-ym-color="var(--accent-color)">Fun</span> <span data-js-title>useless</span> calculator with <a href="https://drafts.csswg.org/css-values-3/#calc-notation" title="Link to CSS Values and Units Module Level 3 Mathematical §Expressions: calc() (Open in a new window)" target="_blank" data-ym-color="var(--primary-text-color):link || var(--primary-text-color):visited || var(--primary-text-color):focus || var(--primary-text-color):hover || var(--primary-text-color):active"><span data-ym-font-variant="small-caps">Css</span> calc()</a>
        </h1>

        <div data-js-result data-ym-display="none" data-ym-grid-column="1@media screen and (min-width: 1024px)" data-ym-grid-row="4@media screen and (max-width: 1023px) || 2@media screen and (min-width: 1024px)" data-ym-justify-self="start@media screen and (max-width: 1023px)" data-ym-row-gap="calc(var(--sss) * 1rem)">
            <div data-ym-display="grid" data-ym-row-gap="1ch">
                <span data-ym-display="flex" data-ym-justify-content="center@media screen and (min-width: 1024px)" data-ym-order="2@media screen and (max-width: 1023px)">
                    <span data-item data-ym-background-color="var(--accent-color)">
                        <span data-ym-font-size="calc(var(--xx) * 1rem)" class="material-symbols-outlined">engineering</span>
                    </span>
                </span>               
                <span data-ym-font-size="calc(var(--xs) * 1rem)">Full <span data-ym-color="var(--accent-color)">results</span> of<span data-ym-color="var(--accent-color)" data-ym-order="1@media screen and (max-width: 1023px)">…</span></span>
                <span data-js-operation data-ym-color="var(--accent-color)" data-ym-font-size="calc(var(--xx) * 1rem)" data-ym-line-break="anywhere" data-ym-order="3@media screen and (max-width: 1023px)"></span>
            </div>
            <div data-ym-display="grid" data-ym-column-gap="1ch" data-ym-grid-template-columns="calc(var(--xxx) * 1rem) 1fr">
                <span data-ym-color="var(--accent-color)" data-ym-font-size="calc(var(--xx) * 1rem)" data-ym-font-variant="small-caps" data-ym-text-orientation="sideways" data-ym-writing-mode="vertical-rl">Css</span>
                <span data-js-result-css data-ym-font-size="calc(var(--xs) * 1rem)" data-ym-line-break="anywhere"></span>
            </div>
            <div data-ym-display="grid" data-ym-column-gap="1ch" data-ym-grid-template-columns="calc(var(--xxx) * 1rem) 1fr" title="
            JavaScript to the rescue!">
                <span data-ym-color="var(--accent-color)" data-ym-font-size="calc(var(--xx) * 1rem)" data-ym-font-variant="small-caps" data-ym-text-orientation="sideways" data-ym-writing-mode="vertical-rl">Js</span>
                <span data-js-result-js data-ym-font-size="calc(var(--xs) * 1rem)" data-ym-line-break="anywhere"></span>
            </div>
        </div>

        <div data-js-screen 
        data-ym-display="grid" data-ym-gap="calc(var(--ss) * 1rem)" data-ym-grid-row="2@media screen and (max-width: 1023px) || 1@media screen and (min-width: 1024px)" data-ym-grid-column="2@media screen and (min-width: 1024px)" data-ym-grid-template-columns="repeat(5, calc(var(--xxx) * 1rem))" data-ym-grid-template-rows="repeat(3, calc(var(--xxx) * 1rem))"></div>
        <div data-js-keypad data-ym-align-content="start@media screen and (min-width: 1024px)" data-ym-display="grid" data-ym-gap="calc(var(--ss) * 1rem)" data-ym-grid-row="3@media screen and (max-width: 1023px) || 2@media screen and (min-width: 1024px)" data-ym-grid-column="2@media screen and (min-width: 1024px)" data-ym-grid-columns="repeat(4, calc(var(--xxx) * 1rem))">
            <span data-ym-grid-column="1" data-ym-grid-row="1">
                <span>1</span>
            </span>
            <span data-ym-grid-column="2" data-ym-grid-row="1">
                <span>2</span>
            </span>
            <span data-ym-grid-column="3" data-ym-grid-row="1">
                <span>3</span>
            </span>
            <span data-ym-grid-column="4" data-ym-grid-row="1">
                <span>4</span>
            </span>
            <span data-ym-grid-column="5" data-ym-grid-row="1">
                <span>+</span>
            </span>
            <span data-ym-grid-column="1" data-ym-grid-row="2">
                <span>5</span>
            </span>
            <span data-ym-grid-column="2" data-ym-grid-row="2">
                <span>6</span>
            </span>
            <span data-ym-grid-column="3" data-ym-grid-row="2">
                <span>7</span>
            </span>
            <span data-ym-grid-column="4" data-ym-grid-row="2">
                <span>8</span>
            </span>
            <span data-ym-grid-column="5" data-ym-grid-row="2">
                <span>−</span>
            </span>
            <span data-ym-grid-column="1" data-ym-grid-row="3">
                <span>9</span>
            </span>
            <span data-ym-grid-column="2" data-ym-grid-row="3">
                <span>0</span>
            </span>
            <span data-ym-grid-column="4" data-ym-grid-row="3">
                <span>.</span>
            </span>
            <span data-ym-grid-column="5" data-ym-grid-row="3">
                <span>×</span>
            </span>
            <span data-ym-grid-column="1" data-ym-grid-row="4">
                <span>(</span>
            </span>
            <span data-ym-grid-column="2" data-ym-grid-row="4">
                <span>)</span>
            </span>
            <span data-ym-grid-column="3" data-ym-grid-row="4">
                <span class="material-symbols-outlined" title="restore (and delete) last result">restore</span>
            </span>
            <span data-ym-grid-column="4" data-ym-grid-row="4" title="delete last entry">
                <span class="material-symbols-outlined">backspace</span>
            </span>
            <span data-ym-grid-column="5" data-ym-grid-row="4">
                <span>÷</span>
            </span>
            <span data-ym-grid-column="1" data-ym-grid-row="5" title="save result">
                <span class="material-symbols-outlined">save</span>
            </span>
            <span data-ym-grid-column="3" data-ym-grid-row="5">
                <span>=</span>
            </span>
            <span data-ym-grid-column="5" data-ym-grid-row="5" title="reset">
                <span class="material-symbols-outlined">delete</span>
            </span>
        </div>

<script>

const titlePage = 'Fun calculator with Css calc()';

const keypad = document.querySelector('[data-js-keypad]');

const screen = document.querySelector('[data-js-screen]');

const placeholderInvite = 'Press items, e.g. 1 ÷ 3…';

const placeholderRotate = 'Please rotate your device!';

document.title = titlePage;

const drawFromFavicon = () => {

    try {

        let favicon = document.querySelector('link[rel=icon]');

        let htmlStyle = getComputedStyle(document.documentElement);

        let color = htmlStyle.getPropertyValue('--primary-text');

        if (favicon) {
        
            let icon = favicon.getAttribute('data-icon');

            if (icon) {

                let canvas = document.createElement('canvas');

                canvas.height = 64;

                canvas.width = 64;

                let ctx = canvas.getContext('2d');

                ctx.fillStyle = color;

                ctx.font = '500 64px sans-serif';

                ctx.textAlign = 'center';

                ctx.textBaseline = 'middle';
                
                ctx.fillText(icon, canvas.height/2, canvas.width/2);

                favicon.href = canvas.toDataURL();

                canvas.remove();
                
            }
        
        }

    } catch {

        return false;

    }

};

const getDimensions = () => {

    try {

        let widthScreen = window.screen.width * window.devicePixelRatio;

        let heightScreen = window.screen.height * window.devicePixelRatio;

        let scale = '';

        if (heightScreen > widthScreen) {

            scale = heightScreen / widthScreen;

        } else {

            scale = widthScreen / heightScreen;

        }

        document.documentElement.style.setProperty('--scaleScreen', scale);

        document.documentElement.style.setProperty('--xxxx', Math.pow(scale, 3));

        document.documentElement.style.setProperty('--xxx', Math.pow(scale, 2.5));

        document.documentElement.style.setProperty('--xx', Math.pow(scale, 2));

        document.documentElement.style.setProperty('--x', Math.pow(scale, 1.5));

        document.documentElement.style.setProperty('--xs', Math.pow(scale, 1));

        document.documentElement.style.setProperty('--s', Math.pow(scale, 0.5));

        document.documentElement.style.setProperty('--ss', Math.pow(scale, 0));

        document.documentElement.style.setProperty('--sss', Math.pow(scale, -0.5));

        document.documentElement.style.setProperty('--ssss', Math.pow(scale, -1));

        document.documentElement.style.setProperty('--sssss', Math.pow(scale, -1.5));

        document.documentElement.style.setProperty('--ssssss', Math.pow(scale, -2));

        document.documentElement.style.setProperty('--sssssss', Math.pow(scale, -2.5));

        document.documentElement.style.setProperty('--ssssssss', Math.pow(scale, -3));

        document.documentElement.style.setProperty('--sssssssss', Math.pow(scale, -3.5));

        document.documentElement.style.setProperty('--line-height', Math.pow(scale, 1));

    } catch {

        return false;

    }

};

const listenOrientationChange = () => {

    window.addEventListener('orientationchange', () => {

        location.reload();

    });

};

const setStyles = () => {

    try {

        /* https://www.materialpalette.com/amber/lime */

        document.documentElement.style.setProperty('--accent-color', '#cddc39');

        document.documentElement.style.setProperty('--dark-primary-color', '#ffa000');

        document.documentElement.style.setProperty('--light-primary-color', '#ffecb3');

        document.documentElement.style.setProperty('--divider-color', '#bdbdbd');

        document.documentElement.style.setProperty('--primary-color', '#ffc107');

        document.documentElement.style.setProperty('--primary-text-color', '#212121');

        document.documentElement.style.setProperty('--secondary-text-color', '#757575');

        document.documentElement.style.setProperty('--font-family', '"Space Mono", monospace');

        document.documentElement.style.setProperty('--font-weight-regular', '400');

        document.documentElement.style.setProperty('--font-weight-bold', '700');

        document.documentElement.style.setProperty('--margin-block-start-regular', 'calc(var(--ss) * 1rem');

    } catch {

        return false;

    }

};

const shapeContent = () => {

    try {

        document.querySelector('title').setAttribute('data-js-title-document', document.querySelector('title').textContent);

        keypad.querySelectorAll(':scope > span').forEach((span) => {

            span.firstElementChild.setAttribute('data-ym-font-size', 'calc(var(--xx) * 1rem)');

            span.setAttribute('data-item', span.firstElementChild.textContent);

        });

        initResult();

        toggleButtons(false);
    

    } catch {

        return false; 

    }

};

const clearResult = (result) => {

    if (document.querySelector('[data-js-title]').hasAttribute('data-ym-text-decoration')) {

        document.querySelector('[data-js-title]').removeAttribute('data-ym-text-decoration');

    }

    if (document.querySelector('[data-js-result]') && document.querySelector('[data-js-result]').hasAttribute('data-ym-display') && document.querySelector('[data-js-result]').getAttribute('data-ym-display') === 'grid') {

        if (document.querySelector('[data-js-operation]').innerHTML != '') {

            document.querySelector('[data-js-operation]').innerHTML = '';

        }

        if (document.querySelector('[data-js-result-css]').innerHTML != '') {

            document.querySelector('[data-js-result-css]').innerHTML = '';

        }

        if (document.querySelector('[data-js-result-js]').innerHTML != '') {

            document.querySelector('[data-js-result-js]').innerHTML = '';

        }

        document.querySelector('[data-js-result]').setAttribute('data-ym-display', 'none');

    }

}

const createCss = (solveQuery) => {

        let resultCss;

        document.documentElement.style.setProperty(`--dimension`, `calc(${solveQuery})`)

        let div = document.createElement('div');

        div.setAttribute('style', 'margin-block-start: calc(var(--dimension) * 1px)');

        document.body.insertAdjacentElement('afterbegin', div);

        /*
            *
                Nous utilisons "try / catch" afin d'obvier à la levée d'une erreur, car la méthode "computedStyleMap" n'est pas supportée par Firefox (version 117 lors du développement). 
            *
        */

        try {

            resultCss = div.computedStyleMap().get('margin-block-start').value;

        } catch {

            resultCss = window.getComputedStyle(div).marginBlockStart.replace('px', '');

        }

        document.body.removeChild(div);

        document.documentElement.style.removeProperty('--dimension');

        return resultCss;


};


const displayResult = (result) => {

    if (screen.innerHTML != '') {

        screen.innerHTML = '';

    }

    let response = '';

    for (let i = 0; i < result.length; i++) {

        response += `<span data-item data-ym-background-color="var(--primary-color)"><span data-ym-font-size="calc(var(--xx) * 1rem)">${result[i].replace(`-`, `−`)}</span></span>`;

    }

    screen.insertAdjacentHTML('afterbegin', response);

};

const initResult = () => {

    if (document.title !== titlePage) {

        document.title = titlePage;

    }

    if (screen.innerHTML != '') {

        screen.innerHTML = '';

    }

    const mediaQuery = window.matchMedia('screen and (max-width: 1023px) and (orientation: landscape)');

    const isLandscape = mediaQuery.matches;

    const helpText = isLandscape ? placeholderRotate : placeholderInvite;

    const help = `<span data-ym-align-items="center" data-ym-display="inline-flex" data-ym-justify-content="center" data-ym-grid-column="1 / span 5" data-ym-grid-row="2@media screen and (min-width: 1024px)">${helpText}</span>`;

    screen.insertAdjacentHTML('afterbegin', help);

};

const handleBackspace = () => {

    if (document.querySelector('[data-js-screen]').hasChildNodes()) {

        document.querySelector('[data-js-screen]').removeChild(document.querySelector('[data-js-screen]').lastElementChild);

    }

};

const handleDelete = () => {

    clearResult();

    initResult();

    toggleButtons(false);

};

const handleEqual = () => {

    /*
        *
            Nous utilisons "try / catch" afin d'obvier à la levée d'une erreur, si le calcul demandé est impossible. 
        *
    */

    try {

        const query = screen.textContent;

        const solveQuery = query
            .replaceAll(/\s/g, '')
            .replaceAll('+', ' + ')
            .replaceAll('−', ' - ')
            .replaceAll('×', '*')
            .replaceAll('÷', ' / ')
            .replaceAll('⟮', '(')
            .replaceAll('⟯', ')');

        let computeCss = createCss(solveQuery);

        let computeJs = eval(solveQuery);

        let formateCss = computeCss.toString().substring(0, 15);    

        document.title = formateCss + ' 😊';

        document.querySelector('[data-js-title]').setAttribute('data-ym-text-decoration', 'line-through var(--accent-color) solid');

        document.querySelector('[data-js-operation]').insertAdjacentHTML('afterbegin', query);

        displayResult(formateCss);

        document.querySelector('[data-js-result]').setAttribute('data-ym-display', 'grid');

        let resultCss = `<p data-ym-color="var(--primary-color)" data-ym-display="block"  data-ym-line-break="anywhere">${computeCss}</p>`;

        let resultJs = `<p data-ym-color="var(--primary-color)" data-ym-display="block"  data-ym-line-break="anywhere">${computeJs}</p>`;

        document.querySelector('[data-js-result-css]').innerHTML = '';

        document.querySelector('[data-js-result-css]').insertAdjacentHTML('afterbegin', resultCss);

        document.querySelector('[data-js-result-js]').innerHTML = '';

        document.querySelector('[data-js-result-js]').insertAdjacentHTML('afterbegin', resultJs);

        toggleButtons(true);

    } catch {

        screen.innerHTML = '';

        let computeError = `<span data-ym-align-items="center" data-ym-display="inline-flex" data-ym-justify-content="center" data-ym-grid-column="1 / span 5" data-ym-grid-row="2@media screen and (min-width: 1024px)">Error</span>`;

        screen.insertAdjacentHTML('afterbegin', computeError);

        toggleButtons(true);

    }

};

const handleDefault = (item) => {

    if (screen.textContent === placeholderInvite) {


        /*
            *
                C'est le premier chiffre.
            *
        */

        const itemHTML = `<span data-item data-ym-background-color="var(--primary-color)"><span data-ym-font-size="calc(var(--xx) * 1rem)">${item.getAttribute(`data-item`)}</span></span>`;

        screen.innerHTML = '';

        screen.insertAdjacentHTML('beforeend', itemHTML);

    } else {

        if (screen.querySelectorAll('[data-item]').length <= 14) {

            /*
                *
                    Autres entrées. La limite est fixée à 14 caractères.
                *
            */

            const itemHTML = `<span data-item data-ym-background-color="var(--primary-color)"><span data-ym-font-size="calc(var(--xx) * 1rem)">${item.getAttribute(`data-item`)}</span></span>`;

            screen.insertAdjacentHTML('beforeend', itemHTML);

        }

    }

};

const handleRestore = () => {

        if (localStorage.getItem('data-store')) {

            displayResult(localStorage.getItem('data-store'));

            localStorage.removeItem('data-store');

        }

        clearResult();

        toggleButtons(false);

};


const handleSave = () => {

        let store = document.querySelector('[data-js-screen]').textContent;

        localStorage.setItem('data-store', store);

        if (document.querySelector('[data-js-screen]')) {

            document.querySelector('[data-js-screen]').innerHTML = '';

            document.querySelector('[data-js-screen]').insertAdjacentHTML('afterbegin', `<span data-ym-align-items="center" data-ym-display="inline-flex" data-ym-justify-content="center" data-ym-grid-column="1 / span 5" data-ym-grid-row="2@media screen and (min-width: 1024px)">${store} is copied!</span>`);

        }

        clearResult();

        toggleButtons(false);

};

const performCalculation = () => {

    const itemFunctionMap = {

        'backspace': handleBackspace,

        'delete': handleDelete,

        'restore': handleRestore,

        'save': handleSave,

        '=': handleEqual

    };


    keypad.querySelectorAll('[data-item]').forEach((item) => {

        item.addEventListener('click', event => {

            const dataItemValue = item.getAttribute('data-item');

            const handlerFunction = itemFunctionMap[dataItemValue];

            if (handlerFunction) {

                handlerFunction();

            } else {

                handleDefault(item);

            }

        });

    });

};

const toggleButtons = (reverse) => {

    /*
        *
            Sans le paramètre "reverse", nous activons tous les boutons, sauf "save". Si une entrée "data-store" n'est pas 
            enregistrée, le bouton "restore" est également inactif. Le bouton "reset" est actif.
            
            Avec le paramètre "reverse", nous activons le bouton "reset" et désactivons les autres. S'il n'y a pas eu d'ereur de calcul, le bouton "save" est activé. Le bouton "reset" reste actif.
        *
    */

    const attributes = ['data-ym-background-color', 'data-ym-cursor', 'data-ym-pointer-events', 'data-ym-color'];

    function setItemAttributes(item, reverse) {

        const primaryColor = reverse ? 'var(--light-primary-color)' : 'var(--primary-color)';

        const cursor = reverse ? 'none' : 'pointer';

        const pointerEvents = reverse ? 'none' : 'auto';

        const textColor = reverse ? 'var(--secondary-text-color)' : 'var(--primary-text-color)';

        item.setAttribute('data-ym-background-color', primaryColor);

        item.setAttribute('data-ym-cursor', cursor);

        item.setAttribute('data-ym-pointer-events', pointerEvents);

        item.firstElementChild.setAttribute('data-ym-color', textColor);

    }

    const secondaryButtons = ['save'];

    if (!localStorage.getItem('data-store')) {

        secondaryButtons.push('restore');

    }

    const secondaryButtonsReverse = ['delete'];

    if (screen.textContent !== 'Error') {

        secondaryButtonsReverse.push('save');

    }

    keypad.querySelectorAll('[data-item]').forEach((item) => {

        attributes.forEach(attr => {

            if (item.hasAttribute(attr)) {

                item.removeAttribute(attr);

            }

            if (item.firstElementChild.hasAttribute(attr)) {

                item.firstElementChild.removeAttribute(attr);

            }

        });

        if (!reverse) {

            if (!secondaryButtons.includes(item.textContent.trim())) {

                setItemAttributes(item, false);

            } else {

                setItemAttributes(item, true);

            }

        } else {

            if (!secondaryButtonsReverse.includes(item.textContent.trim())) {

                setItemAttributes(item, true);

            } else {

                setItemAttributes(item, false);
            }

        }

    });

};

async function runAsyncTasks() {

    try {

        await shapeContent();

        await setStyles();

        await drawFromFavicon();

        await getDimensions();

        await performCalculation();

        await listenOrientationChange();

    } catch (error) {

        console.log(error.name);

        console.log(error.message);

    }

}

runAsyncTasks();

var cssAfterLymnee = `
[data-item] {
    align-items: center;
    border-radius: 50%;
    display: inline-flex;
    height: calc(var(--xxx) * 1rem);
    justify-content: center;
    width: calc(var(--xxx) * 1rem)
}

/* https://css-tricks.com/snippets/css/orientation-lock/ */
`;

var cssBeforeLymnee = `

.material-symbols-outlined {
  font-variation-settings:
  'FILL' 0,
  'wght' 700,
  'GRAD' 0,
  'opsz' 48
}

* {
    box-sizing: border-box
}`;

var entriesLymnee = new Set(['data-ym-background-color="var(--light-primary-color)"', 'data-ym-text-decoration="line-through var(--accent-color) solid"']),

unsetLymnee = true;
</script>
<script src="https://cdn.jsdelivr.net/gh/lymnee/lymnee/lymnee.reload.js"></script>
</body>
</html>
